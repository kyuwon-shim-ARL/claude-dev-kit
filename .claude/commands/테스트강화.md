<!--
@meta
id: command_20250905_test_integrity
type: command
scope: operational
status: active
created: 2025-09-05
updated: 2025-09-05
tags: test, integrity, enforcement
-->

ğŸ›¡ï¸ **í…ŒìŠ¤íŠ¸ê°•í™” (Test Integrity Enforcement System)**

**ğŸ“š ì»¨í…ìŠ¤íŠ¸ ìë™ ë¡œë”©:**
- .github/workflows/*.yml (CI/CD ì„¤ì •)
- tests/ ë””ë ‰í† ë¦¬ êµ¬ì¡°
- pytest.ini ë˜ëŠ” setup.cfg
- ìµœê·¼ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼

**ğŸ¯ ì—­í• : AIì˜ í…ŒìŠ¤íŠ¸ ìš°íšŒ/ì¡°ì‘ ë°©ì§€ ì‹œìŠ¤í…œ êµ¬ì¶•**

## 1. ğŸ” **í˜„ì¬ ìƒíƒœ ì§„ë‹¨ (20% ë¹„ì¤‘)**

**í…ŒìŠ¤íŠ¸ í™˜ê²½ ë¶„ì„:**
```python
def diagnose_test_environment():
    checks = {
        "pytest_installed": check_pytest(),
        "ci_configured": check_github_actions(),
        "pre_commit_hooks": check_git_hooks(),
        "test_coverage": measure_coverage(),
        "mock_usage": analyze_mock_patterns(),
        "test_quality": assess_test_quality()
    }
    return generate_diagnosis_report(checks)
```

## 2. ğŸš¨ **ë¬´ê²°ì„± ê°•ì œ ì‹œìŠ¤í…œ ì„¤ì¹˜ (40% ë¹„ì¤‘)**

### ìë™ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸:
```bash
#!/bin/bash
# install_test_integrity.sh

echo "ğŸ›¡ï¸ Installing Test Integrity System..."

# 1. Pre-commit hooks ì„¤ì¹˜
cat > .git/hooks/pre-commit << 'EOF'
#!/bin/bash
# Test Integrity Check

# í…ŒìŠ¤íŠ¸ ê°œìˆ˜ ê°ì†Œ ë°©ì§€
BEFORE=$(git show HEAD:tests/ 2>/dev/null | grep -c "def test_" || echo 0)
CURRENT=$(find tests/ -name "*.py" -exec grep -c "def test_" {} \; | awk '{sum+=$1} END {print sum}')

if [ "$CURRENT" -lt "$BEFORE" ]; then
    echo "âŒ í…ŒìŠ¤íŠ¸ ì‚­ì œ ê°ì§€! ($BEFORE â†’ $CURRENT)"
    echo "ğŸ’¡ í…ŒìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì§€ ë§ê³  ìˆ˜ì •í•˜ì„¸ìš”"
    exit 1
fi

# ì‹¤ì œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
pytest --tb=short --strict-markers || exit 1

echo "âœ… Test integrity verified"
EOF
chmod +x .git/hooks/pre-commit

# 2. GitHub Actions ì›Œí¬í”Œë¡œìš° ìƒì„±
mkdir -p .github/workflows
cat > .github/workflows/test-integrity.yml << 'EOF'
name: Test Integrity Enforcement
on: [push, pull_request]

jobs:
  enforce-integrity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Count Tests
        id: count
        run: |
          echo "total=$(find . -name 'test*.py' -exec grep -c 'def test_' {} \; | awk '{sum+=$1} END {print sum}')" >> $GITHUB_OUTPUT
      
      - name: Run All Tests
        run: |
          pip install pytest pytest-cov
          pytest --no-skip --strict-markers
      
      - name: Check Mock Usage
        run: |
          python scripts/detect_mock_usage.py --max-percentage 20
      
      - name: Verify Quality
        run: |
          python scripts/validate_test_quality.py --min-assertions 2
EOF

# 3. ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ì„¤ì¹˜
python scripts/enforce_test_integrity.py --install

echo "âœ… Test Integrity System installed!"
```

## 3. ğŸ”’ **ìš°íšŒ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜ (25% ë¹„ì¤‘)**

### AI í–‰ë™ íŒ¨í„´ ì°¨ë‹¨:
```python
# scripts/block_ai_cheating.py

class AICheatBlocker:
    """AIì˜ í…ŒìŠ¤íŠ¸ ìš°íšŒ ì‹œë„ ì°¨ë‹¨"""
    
    FORBIDDEN_PATTERNS = [
        # í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ
        (r"@pytest\.mark\.skip", "í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ ê¸ˆì§€"),
        (r"@unittest\.skip", "í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ ê¸ˆì§€"),
        
        # Theater Testing
        (r"assert.*is\s+not\s+None$", "ì˜ë¯¸ì—†ëŠ” assertion"),
        (r"assert\s+True$", "í•­ìƒ í†µê³¼í•˜ëŠ” í…ŒìŠ¤íŠ¸"),
        (r"pass\s*#.*test", "ë¹ˆ í…ŒìŠ¤íŠ¸ ë³¸ë¬¸"),
        
        # í…ŒìŠ¤íŠ¸ ì‚­ì œ
        (r"^-.*def test_", "í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì‚­ì œ"),
        
        # Mock ë‚¨ìš©
        (r"mock\.Mock\(\).*mock\.Mock\(\)", "ê³¼ë„í•œ Mock ì‚¬ìš©")
    ]
    
    def scan_changes(self, diff_content):
        violations = []
        for pattern, message in self.FORBIDDEN_PATTERNS:
            if re.search(pattern, diff_content, re.MULTILINE):
                violations.append({
                    "pattern": pattern,
                    "message": message,
                    "severity": "HIGH"
                })
        
        if violations:
            self.block_commit(violations)
            return False
        return True
    
    def block_commit(self, violations):
        print("ğŸš¨ í…ŒìŠ¤íŠ¸ ì¡°ì‘ ì‹œë„ ê°ì§€!")
        for v in violations:
            print(f"  âŒ {v['message']}")
        print("\nìˆ˜ì • ë°©ë²•:")
        print("  1. ì‹¤íŒ¨í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‚­ì œí•˜ì§€ ë§ê³  ìˆ˜ì •")
        print("  2. êµ¬ì²´ì ì¸ ê°’ì„ ê²€ì¦í•˜ëŠ” assertion ì‚¬ìš©")
        print("  3. Mock ëŒ€ì‹  ì‹¤ì œ ê°ì²´ ì‚¬ìš©")
        raise TestIntegrityViolation()
```

## 4. ğŸ“Š **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ (15% ë¹„ì¤‘)**

### ìë™ ìƒì„± ëŒ€ì‹œë³´ë“œ:
```python
def generate_integrity_dashboard():
    """í…ŒìŠ¤íŠ¸ ë¬´ê²°ì„± ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ"""
    
    stats = collect_test_statistics()
    violations = check_recent_violations()
    
    dashboard = f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘        TEST INTEGRITY DASHBOARD            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸ“Š í…ŒìŠ¤íŠ¸ í†µê³„                            â•‘
â•‘   Total: {stats['total']} ({stats['delta']:+d} from last)    â•‘
â•‘   Pass Rate: {stats['pass_rate']:.1f}%                   â•‘
â•‘   Coverage: {stats['coverage']:.1f}%                     â•‘
â•‘   Mock Usage: {stats['mock_usage']:.1f}% {'âœ…' if stats['mock_usage'] < 20 else 'âŒ'}      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ ğŸš¨ ìµœê·¼ ìœ„ë°˜ ì‚¬í•­                         â•‘
"""
    
    for v in violations[-3:]:
        dashboard += f"â•‘   â€¢ {v['time']}: {v['type']:20} â•‘\n"
    
    dashboard += """â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ âœ… ê°•ì œ ì‚¬í•­                              â•‘
â•‘   â€¢ í…ŒìŠ¤íŠ¸ ì‚­ì œ ë¶ˆê°€                      â•‘
â•‘   â€¢ Mock < 20%                            â•‘
â•‘   â€¢ Assertion â‰¥ 2 per test                â•‘
â•‘   â€¢ ëª¨ë“  CI ì²´í¬ í†µê³¼ í•„ìˆ˜                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
    return dashboard
```

## 5. ğŸ¯ **ì™„ë£Œ ì¡°ê±´ ë° ê²€ì¦**

**ì„¤ì¹˜ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸:**
- [ ] Pre-commit hook ì„¤ì¹˜ ë° ì‘ë™
- [ ] GitHub Actions ì›Œí¬í”Œë¡œìš° í™œì„±í™”
- [ ] ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ëª¨ë‘ ì‹¤í–‰ ê°€ëŠ¥
- [ ] ì²« í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì„±ê³µ
- [ ] AI ìš°íšŒ ì‹œë„ ì°¨ë‹¨ í™•ì¸

**ìë™ ê²€ì¦:**
```bash
# ì„¤ì¹˜ ê²€ì¦
./scripts/verify_integrity_installation.sh

# ì¶œë ¥ ì˜ˆì‹œ:
âœ… Pre-commit hooks: Installed
âœ… GitHub Actions: Configured
âœ… Python scripts: Available
âœ… Test baseline: Recorded (127 tests)
âœ… Mock detector: Active
ğŸ‰ Test Integrity System Ready!
```

**ğŸ’¡ ìŠ¬ë˜ì‹œ ì»¤ë§¨ë“œ ì‹¤í–‰ íë¦„:**
1. `/í…ŒìŠ¤íŠ¸ê°•í™”` ì‹¤í–‰
2. í˜„ì¬ í™˜ê²½ ìë™ ì§„ë‹¨
3. í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë§Œ ì„ íƒì  ì„¤ì¹˜
4. ì„¤ì¹˜ ê²€ì¦ ë° ë¦¬í¬íŠ¸
5. ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ í‘œì‹œ

**ğŸš€ ë¹ ë¥¸ ì‹œì‘:**
```bash
# í•œ ì¤„ë¡œ ëª¨ë“  ê²ƒ ì„¤ì¹˜
curl -fsSL https://raw.githubusercontent.com/your-repo/main/install-test-integrity.sh | bash
```

**ì‚°ì¶œë¬¼: ì™„ì „í•œ í…ŒìŠ¤íŠ¸ ë¬´ê²°ì„± ì‹œìŠ¤í…œ + AI ìš°íšŒ ë¶ˆê°€ëŠ¥í•œ í™˜ê²½**