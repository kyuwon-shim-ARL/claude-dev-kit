<!--
@meta
id: deployment_20250905_1135_6command_integration
type: implementation
scope: operational
status: published
created: 2025-09-05
updated: 2025-09-05
tags: commands, 배포.md, automation, 6-command-integration, 3-layer-docs
related: slash-command-restructuring-v31.md
-->

# 🚀 배포 - 6개 통합 + 3-Layer 자동 정리 시스템 v31.0

## 🎯 핵심 목적
**완전 자동화**: 검증 + 배포 + 6개 기존 커맨드 통합 + 3-Layer 문서화

## 📋 6개 통합 커맨드 기능

**이 배포 커맨드는 다음 6개를 완전 통합:**

### 1. **안정화** - 구조적 지속가능성
- DRY 원칙 적용 및 순환 의존성 해결
- 디렉토리 구조 정리 및 네이밍 표준화
- 성능 최적화 (정량 측정)

### 2. **문서정리** - 지능형 분류 시스템
- 완료 작업 → docs/archive/ 자동 이관
- 중요 결정사항 → docs/decisions/ 자동 추출
- 메타데이터 기반 자동 분류

### 3. **레포정리** - Repository 최적화
- Root 정리: 필수 파일만 유지
- 임시 파일 정리: *.tmp, *.bak 자동 삭제
- 계층구조: src/{project}/core/, services/, models/ 준수

### 4. **개발완료** - 품질 게이트 검증
- 모든 테스트 통과 확인
- Coverage 기준 달성 (15% 이상)
- Theater Testing 0개 보장

### 5. **배포** - 원격 배포 실행
- Git push origin main
- 버전 태그 생성 및 푸시
- 배포 상태 검증

### 6. **세션마감** - 세션 완료 처리
- 전체 세션 요약 생성
- 미완료 TODO 다음 세션으로 이관
- 컨텍스트 최적화

## 📚 3-Layer 지능형 문서화 시스템

### **Layer 1: 실시간 자동화** (무의식적)
- 모든 작업 → docs/CURRENT/ 실시간 기록
- Git hook → 커밋마다 CLAUDE.md 자동 동기화
- TodoWrite → active-todos.md 실시간 업데이트

### **Layer 2: 주기별 스마트 정리** (semi-auto)
- 5번째 커밋마다 → 자동 문서 분류 트리거
- 완료 작업 → docs/archive/ 자동 이관
- 중요 결정사항 → docs/decisions/ 자동 추출

### **Layer 3: 세션 종료 시점** (배포 내장)
- 전체 세션 요약 → weekly-summary.md 생성
- 미완료 TODO → 다음 세션으로 이관
- 컨텍스트 최적화 → .claudeignore 자동 업데이트

## 🚀 **기존 GitHub Actions 통합 배포 기능 유지**

**📚 컨텍스트 자동 로딩:**
- project_rules.md 확인 (있으면 읽기)
- docs/CURRENT/ 전체 상태 확인

**🎯 진정한 배포 성공 조건 (v30.1):**
- ✅ 로컬 TADD 검증 통과
- ✅ Git Push 성공  
- ✅ **GitHub Actions 전체 통과 (필수!)**
- ✅ Branch Protection Rules 통과
- ✅ 모든 Required Status Checks 성공

**⚠️ 중요: 더 이상 "Push만 하면 성공" 아님!**

**📋 3단계 배포 프로세스:**

**Phase A: Pre-Push 검증**
```bash
echo "🔍 Pre-push TADD 검증..."
./scripts/quick_tadd_check.sh
if [ $? -ne 0 ]; then
    echo "❌ 로컬 검증 실패 - GitHub Actions도 실패할 예정"
    echo "먼저 로컬 문제를 해결하세요."
    exit 1
fi
```

**Phase B: 구조화 커밋 + Push**
- 의미있는 커밋 메시지: 변경사항의 목적과 영향 명시
- 원자성 보장: 하나의 논리적 변경사항 = 하나의 커밋
- **git push origin main**: 변경사항을 즉시 원격 저장소에 전송

**Phase C: GitHub Actions 실시간 모니터링**
```bash
echo "🔄 GitHub Actions 실시간 모니터링 시작..."
./scripts/monitor_github_actions.sh
```

**✅ 성공 시:**
- "🎉 GitHub Actions: 전체 통과!"
- "🎉 진정한 배포 완료!" 

**❌ 실패 시:**
- 실패 로그 자동 분석
- 구체적 해결방안 제시
- Claude 분석 요청 안내

**🔧 실패 시 자동 분석 기능:**
- **Import 오류**: Python 경로, __init__.py 누락 감지
- **커버리지 부족**: 테스트 추가 또는 임계값 조정 제안  
- **테스트 실패**: 로컬 테스트 실행 방법 안내
- **일반 오류**: GitHub Actions 워크플로우 점검 안내

**🔄 재시도 루프:**
실패 시 다음 옵션 제공:
1. 제안된 해결방안 적용
2. 로컬에서 재테스트: `./scripts/quick_tadd_check.sh`
3. 다시 배포: `/배포`
4. Claude에게 로그 분석 요청

**배포 후 검증:**
- GitHub Actions 모든 job 성공 확인
- 원격 저장소에서 변경사항 반영 확인
- **버전 태깅**: semantic versioning (선택적)
- 성능 지표 추적: 응답시간, 처리량, 오류율

**💡 새로운 배포 정의:**
**배포 성공 = 커밋 + 푸시 + GitHub Actions All Pass + 검증**

**🧠 배포 후 컨텍스트 관리 (자동 실행):**
1. **로드맵 완료 신호**: 현재 워크플로우 사이클 종료 마킹
2. **10분 타이머 시작**: 새 작업 시작 대기 (경계 감지용)
3. **컨텍스트 정리 준비**: 현재 로드맵 관련 정보 분류 및 정리

**🔄 배포 완료 시 컨텍스트 정리 안내:**

📋 **Claude가 실제 작업을 분석하여 최적 명령어를 생성합니다:**

**동적 가이드 생성 (v9.0+):**
Claude가 자동으로 분석하여 제공:
1. 실제 수행한 작업 내용 파악
2. 보존할 중요 파일 식별
3. 제거할 과정 정보 식별
4. 맞춤형 가이드 생성 (85-95% 압축)

**예시:**
```
/compact "v9.0 동적 가이드 시스템 구현. update.sh 버그 수정 포함. 
테스트 코드와 문서 보존. 디버깅 과정 제거"
```

**예상 효과:**
- 컨텍스트 75-85% 감소
- 모든 중요 정보는 docs/CURRENT/에 보존
- 다음 작업을 위한 깨끗한 환경

**📦 스마트 세션 아카이빙 (자동 실행):**

**영속 파일 (유지 및 업데이트):**
- status.md: 완료 내용 추가 후 유지
- active-todos.md: 완료 항목 정리 후 유지
- planning.md: 현재 계획 유지 (최신)
- test-report.md: 최근 테스트 결과 유지 (최신)

**세션별 파일 (아카이브):**
- planning-*.md: 특정 기획 문서를 sessions/로 이동
- implementation-*.md: 구현 기록을 sessions/로 이동
- *-report-*.md: 날짜별 리포트를 sessions/로 이동
- 아카이브 경로: docs/development/sessions/YYYY-MM/session-XXX.md

**임시 파일 (삭제):**
- *.tmp, *.bak: 임시 파일 제거
- duplicate-*.md: 중복 파일 제거
- old-*.md: 오래된 파일 제거

**세션 연속성 보장:**
- 영속 파일은 절대 삭제하지 않음
- 중복 파일은 최신 내용으로 병합
- 다음 세션을 위한 컨텍스트 완벽 보존

**산출물:** 원격 저장소에 반영되어 실제 사용 가능한 프로덕션 서비스 + 완전한 세션 기록