# /주간보고 - 성과 중심 스프린트 리뷰 v4.0

## 명령어 개요
**프로젝트 컨텍스트를 자동 감지**하여 PRD 목표, 테스트 검증, Git 데이터를 적절히 조합하고, **MECE 피라미드 구조**로 As-Is/To-Be/Gap을 명확히 제시하는 **적응형 성과 측정** 주간보고

## 사용법
```
/주간보고                    # 기본 1주 스프린트 기준
/주간보고 --period=2w        # 2주일 기준
/주간보고 --sprint=3         # 최근 3 스프린트 비교
/주간보고 --detailed         # 상세 분석 포함
```

## Claude 실행 프로세스

### 0단계: 프로젝트 컨텍스트 자동 감지
```python
def detect_project_context():
    """프로젝트 상황을 감지하여 최적의 측정 방식 선택"""
    context = {
        "has_prd": check_file_exists("**/PRD*.md", "docs/specs/PRD.md"),
        "has_tests": check_test_infrastructure(),
        "has_project_rules": check_file_exists("project_rules.md"),
        "project_phase": detect_phase_from_commits(),  # 초기/개발/안정화/운영
        "git_maturity": analyze_commit_quality()
    }
    
    # 프로젝트 단계별 우선순위 결정
    if context["project_phase"] == "기획중":
        priorities = {"primary": "PRD_COMPLETION", "secondary": "ARCHITECTURE", "tertiary": "GIT"}
    elif context["project_phase"] == "구현중":
        priorities = {"primary": "TEST_COVERAGE", "secondary": "PRD_ACHIEVEMENT", "tertiary": "GIT"}
    elif context["project_phase"] == "안정화":
        priorities = {"primary": "QUALITY_METRICS", "secondary": "BUG_FIXES", "tertiary": "REFACTOR"}
    else:  # 운영/유지보수
        priorities = {"primary": "STABILITY", "secondary": "ISSUE_RESOLUTION", "tertiary": "MAINTENANCE"}
    
    return context, priorities
```

### 1단계: 통합 데이터 수집 (우선순위 기반)
```python
def collect_integrated_metrics(context, priorities, period="1w"):
    metrics = {}
    
    # PRD 관련 (있는 경우)
    if context["has_prd"]:
        metrics["prd"] = {
            "requirements": extract_requirements_from_prd(),
            "completion": calculate_prd_completion(),
            "success_criteria": extract_success_criteria()
        }
    
    # 테스트 관련 (있는 경우)
    if context["has_tests"]:
        metrics["tests"] = {
            "unit": run_and_collect_unit_tests(),
            "integration": run_and_collect_integration_tests(),
            "e2e": run_and_collect_e2e_tests(),
            "coverage": calculate_overall_coverage(),
            "quality_score": calculate_test_quality_score()
        }
    
    # Git 데이터 (항상 수집, 가중치만 조정)
    metrics["git"] = {
        "commits": git_log(f"--since='{period}'"),
        "velocity": calculate_velocity(commits_per_week),
        "patterns": analyze_commit_patterns(),
        "collaboration": measure_team_collaboration()
    }
    
    # Project Rules 준수도 (있는 경우)
    if context["has_project_rules"]:
        metrics["compliance"] = {
            "architecture": check_architecture_compliance(),
            "standards": check_coding_standards(),
            "performance": check_performance_targets()
        }
    
    return metrics
```

### 2단계: As-Is/To-Be/Gap 정량 분석 (피라미드 구조)
```python
def analyze_as_is_to_be_gap(metrics, context, priorities):
    # 피라미드 구조: 핵심 메시지 도출 (컨텍스트 기반)
    analysis = {
        "executive_summary": {
            "key_insight": extract_context_aware_insight(metrics, priorities),
            "sprint_verdict": determine_verdict_by_priority(metrics, priorities),
            "next_priority": determine_next_focus(metrics, context)
        },
        
        "as_is_state": {  # 현재 상태 (우선순위별 가중치 적용)
            "primary_metric": get_primary_metric_value(metrics, priorities),
            "secondary_metric": get_secondary_metric_value(metrics, priorities),
            "tertiary_metric": get_tertiary_metric_value(metrics, priorities),
            "bottlenecks": identify_context_aware_bottlenecks(metrics, context)
        },
        
        "to_be_targets": {  # 목표 상태
            "primary_target": calculate_primary_target(metrics, priorities),
            "secondary_target": calculate_secondary_target(metrics, priorities),
            "improvement_areas": prioritize_by_context(metrics, context)
        },
        
        "gap_analysis": {  # 차이 및 대응 방안
            "primary_gap": calculate_primary_gap(metrics, priorities),
            "blocked_items": extract_blockers_by_context(metrics, context),
            "self_resolvable": extract_actionable_items(metrics),
            "help_needed": extract_external_dependencies(metrics)
        }
    }
    return analysis
```

### 3단계: Start/Stop/Continue 스크럼 액션 아이템 생성
```python
def generate_scrum_action_items(analysis, metrics, context):
    # 컨텍스트 기반 액션 아이템 생성
    action_items = {
        "start_doing": [
            {
                "action": identify_high_impact_actions_by_phase(context["project_phase"]),
                "rationale": explain_why_based_on_data(metrics),
                "estimated_impact": calculate_expected_improvement(),
                "success_criteria": define_measurable_outcomes()
            }
        ],
        
        "stop_doing": [
            {
                "inefficiency": identify_context_aware_waste(metrics, context),
                "data_evidence": show_metrics_supporting_decision(metrics),
                "alternative": suggest_better_approach_for_phase(context)
            }
        ],
        
        "continue_doing": [
            {
                "strength": identify_working_well_by_priority(metrics, priorities),
                "metrics_proof": show_positive_trends(metrics),
                "amplification": suggest_scaling_methods()
            }
        ],
        
        "blockers": categorize_blockers_by_urgency(analysis["gap_analysis"])
    }
    return action_items
```

### 4단계: 피라미드 구조 보고서 생성 (MECE + 정량화)
```python
def generate_pyramid_report(date, analysis, action_items, context, priorities):
    # 프로젝트 단계 표시
    phase_indicator = get_phase_emoji(context["project_phase"])
    report_path = f"docs/CURRENT/weekly_report_{date}.md"
    
    # 피라미드 구조 보고서 템플릿
    report = f"""# 🎯 Sprint Review - 성과 중심 실증 분석
*{date} | {phase_indicator} {context["project_phase"]} 단계 | 적응형 측정*

## 📊 Executive Summary (피라미드 최상단)

### 🔍 핵심 인사이트
**{analysis["executive_summary"]["key_insight"]}**

### 🎯 Sprint 종합 판정: **{analysis["executive_summary"]["sprint_verdict"]}**
- 주요 지표: {format_primary_metric(analysis, priorities)}
- 다음 우선순위: **{analysis["executive_summary"]["next_priority"]}**

---

## 📈 As-Is Analysis (현재 상태 정량 측정)

### 성과 메트릭스 (우선순위별)
| 카테고리 | 메트릭 | 현재 값 | 목표 | Gap | Status |
|---------|--------|--------|------|-----|---------|
| Primary | {get_primary_name(priorities)} | {analysis["as_is_state"]["primary_metric"]} | {analysis["to_be_targets"]["primary_target"]} | {analysis["gap_analysis"]["primary_gap"]} | {get_status_emoji()} |
| Secondary | {get_secondary_name(priorities)} | {analysis["as_is_state"]["secondary_metric"]} | {analysis["to_be_targets"]["secondary_target"]} | {calculate_gap()} | {get_status_emoji()} |
| Tertiary | {get_tertiary_name(priorities)} | {analysis["as_is_state"]["tertiary_metric"]} | - | - | 📊 |

### MECE 성과 분해
```
{visualize_performance_by_context(metrics, context)}
```

### 프로젝트 단계별 진행 상황
{visualize_phase_progress(context, metrics)}

---

## 🎯 To-Be Targets (목표 상태)

### Next Sprint Goals
{format_context_aware_goals(analysis["to_be_targets"], context)}

### 개선 우선순위 (데이터 기반)
{format_improvement_areas_with_evidence(analysis["to_be_targets"]["improvement_areas"])}

---

## ⚡ Gap Analysis & Action Plan

### 🚀 START DOING (새로 시작)
{format_start_actions_with_rationale(action_items["start_doing"])}

### 🛑 STOP DOING (중단 결정)
{format_stop_actions_with_evidence(action_items["stop_doing"])}

### ✅ CONTINUE DOING (유지 강화)
{format_continue_actions_with_proof(action_items["continue_doing"])}

---

## 🚧 Blockers & Support Needed

### 🆘 External Help Required
{format_external_blockers(action_items["blockers"]["external"])}

### 🛠️ Self-Resolvable (다음 스프린트 내 해결)
{format_self_resolvable(action_items["blockers"]["internal"])}

---

## 📊 Sprint Retrospective Dashboard

### 성과 트렌드 (컨텍스트 적응형)
| Metric | 2주 전 | 지난 주 | 이번 주 | Trend | Target |
|--------|--------|---------|---------|-------|--------|
{generate_context_aware_trends(metrics, context, priorities)}

### 데이터 소스별 기여도
- **PRD 기반**: {calculate_prd_contribution(metrics)}%
- **테스트 검증**: {calculate_test_contribution(metrics)}%
- **Git 활동**: {calculate_git_contribution(metrics)}%
- **규칙 준수**: {calculate_compliance_contribution(metrics)}%

### 성공 패턴 (계속 증폭시킬 것)
{extract_success_patterns_with_metrics(metrics)}

### 개선 필요 패턴 (즉시 대응)
{extract_improvement_patterns_with_data(metrics)}

---

## 🎯 Next Sprint Commitment

### Sprint Goals (SMART + 측정 가능)
{format_smart_goals_with_metrics(analysis["executive_summary"]["next_priority"])}

### Definition of Done (검증 가능)
{define_measurable_completion_criteria(action_items, context)}

### Risk Mitigation (데이터 기반)
{identify_risks_with_probability(analysis, metrics)}

---

## 📋 프로젝트 컨텍스트 정보

### 감지된 환경
- **프로젝트 단계**: {context["project_phase"]}
- **PRD 존재**: {context["has_prd"] and "✅ Yes" or "❌ No"}
- **테스트 인프라**: {context["has_tests"] and "✅ Active" or "⚠️ Limited"}
- **Git 성숙도**: {context["git_maturity"]}/5
- **측정 우선순위**: {priorities["primary"]} > {priorities["secondary"]} > {priorities["tertiary"]}

---

*📅 Next Review: {calculate_next_review_date()}*
*🔄 Sprint Cycle: {get_sprint_cycle_info()}*
*⏱️ Generated: {datetime.now().strftime('%Y-%m-%d %H:%M')}*
*🎯 Measurement Mode: {get_measurement_mode(context)}*
"""
    
    # 파일 저장
    write_file(report_path, report)
    return report_path
```

## 주요 개선점 (v3.0 → v4.0)

### ✅ 프로젝트 컨텍스트 적응형 측정
1. **자동 환경 감지**: PRD 유무, 테스트 인프라, 프로젝트 단계 자동 파악
2. **우선순위 동적 조정**: 프로젝트 단계에 따라 측정 지표 가중치 변경
3. **데이터 소스 유연성**: 있는 데이터로 최선의 분석 제공
4. **단계별 최적화**: 초기/개발/안정화/운영 각 단계에 맞는 지표 강조

### ✅ 구조는 유지, 내용은 강화
- **MECE 피라미드**: ✅ 구조 그대로 유지
- **As-Is/To-Be/Gap**: ✅ 프레임워크 유지
- **Start/Stop/Continue**: ✅ 스크럼 방식 유지
- **데이터 통합**: PRD + 테스트 + Git + Rules 종합 분석

### ✅ 실질적 가치 중심
- **"있는 것"으로 측정**: 모든 데이터 소스가 없어도 작동
- **근거 기반 판단**: 모든 결정에 데이터 근거 제시
- **측정 가능한 목표**: SMART 원칙 + 구체적 수치
- **투명한 기여도**: 각 데이터 소스의 기여도 명시

## 실행 예시

### 입력:
```
/주간보고
```

### Claude 실행:
1. **컨텍스트 감지**: 프로젝트 환경 자동 분석
2. **데이터 수집**: PRD/테스트/Git/Rules 중 가능한 것 수집
3. **가중치 적용**: 프로젝트 단계에 맞는 우선순위 적용
4. **통합 분석**: MECE 구조로 종합 분석
5. **보고서 생성**: 피라미드 구조 유지하며 성과 중심 리포트

### 출력 예시 (개발 단계 프로젝트):
```markdown
# 🎯 Sprint Review - 성과 중심 실증 분석
*2025-08-29 | 🚀 활발개발 단계 | 적응형 측정*

## 📊 Executive Summary

### 🔍 핵심 인사이트
**테스트 커버리지 85% 달성, PRD 요구사항 70% 구현 완료, 품질 지표 모두 목표 초과**

### 🎯 Sprint 종합 판정: **SUCCESS**
- 주요 지표: 테스트 통과율 95% (목표 90%)
- 다음 우선순위: **남은 PRD 요구사항 30% 완료**

## 📈 As-Is Analysis

### 성과 메트릭스 (우선순위별)
| 카테고리 | 메트릭 | 현재 값 | 목표 | Gap | Status |
|---------|--------|--------|------|-----|---------|
| Primary | 테스트 커버리지 | 85% | 80% | +5% | ✅ |
| Secondary | PRD 달성도 | 70% | 75% | -5% | ⚠️ |
| Tertiary | Git Velocity | 3.5/week | 3.0 | +0.5 | 📊 |
```

## 효과

### 📈 적응형 측정
- 프로젝트 상황에 최적화된 지표 자동 선택
- 없는 데이터 소스는 건너뛰고 유연하게 대응

### 🎯 실용성
- PRD 없어도, 테스트 없어도 의미 있는 보고서 생성
- 프로젝트 단계별로 다른 관점 제공

### 🔄 일관성
- 구조와 프레임워크는 동일하게 유지
- 내용만 컨텍스트에 맞게 조정

---
*프로젝트 상황을 자동 감지하여 최적의 성과 측정 방식을 적용합니다.*